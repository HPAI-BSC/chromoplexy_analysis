# Chromoplexy analyisis

In this repository we analyze data from 2800 patients with cancer. 
The main objective is to use genetic data to classify the cancer type of the patients. 
In order to do so we divide the process in several steps. 


Note: All the code shall run from src. 

### Step 1: Data processing

**input:** 

- *allfiles*:A folder with one file per patient with the starting chromosome, the start of the break, 
the second chromosome and the end of the break. 
- *cancer_classification*: a file with the patient identifiers, the number of breaks per patient, 
if it has chromoplexy or not the number of chromoplexy events, the **cancer type** and the country. 


**output:**

In this step we generate a graph per patient, in order to simplify the study. 

**files**
- loader
- graph_builder
- graphnx
- main_graph_printer

### Step 2: Graph analysis

In this step we use the code from [https://github.com/betterenvi/gSpan]

**input**

**output**

**order**
1. First you generate a gspan compatible graph with *main_gspan_subgraph_generator*

```
python2 step2/main_gspan_subgraph_generator.py 1000 > mapping.txt
```

2. Run gspan stuff. This module searchs the most common subgraphs over the given graph.
Parameters: -l minimum nodes, -s minimum support of the subgraph. 

```
 python2 -m gspan_mining '../data/results/gspan_test.txt' -l 3 -s 10 > ../data/results/gspan_output.txt
```
3. Run *main_freq_subgraph* over the file generated by gspan code. 
This code will generate a pdf with all the subgraphs found by gspan. 

```
python step2/main_freq_subgraph_plotter.py '../data/results/gspan_output.txt'
```

**files**
- *main_gspan_subgraph_generator*: This file has the code to generate the gspan subgraphs. 
- *main_freq_subgraph*: Generates a pdf with all the subgraphs found by gspan. 
- *main_clique_analysis*: This code generates a graphs from the breaks data. Given a clique size, computes and stores the number of cliques, their chromosomic location, and their range within the chromosome, per patient.


### Step 3: Classification

**input**

**output**


#### TODO: 
- New structure to the code (done)
- Add the weight to the vertex (done)
- Make the classification part 
- New code for subgraph feature extraction: 
    For every patient: 
        1. Gets the patient graph and plots it.  
        2. Gets the all the subgraph patterns of this graph. 
        3. Generates the sample in terms of subgraphs of this patient. 
            (dict\[sub_graph\] = number of sub_graphs of this type)
        4. Add to the general list the new subgraphs. 
    Generates a list of the most common patterns for all the patients. 

- Find a way to codify the patterns in order to use them as features.     
- Add to the graphs the edge weight as the number of repeated edges over the selected two vertex.
- Find a chronotripsis criteria. 
- Make some histograms of the weights of the vertex depending on the max_distance given. (done)
- Study the concept of chromotripsis and find a way to relate it with the max distance. 

#### Notas:
. Take care of overfitting. 